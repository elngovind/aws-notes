# AWS Site-to-Site VPN

## MyLearning.com's Hybrid Cloud Journey (Early 2023)

### The On-Premises Challenge
As MyLearning.com grew, they maintained critical infrastructure on-premises while expanding to AWS:

```
Hybrid Infrastructure Requirements:
├── On-Premises Data Center (Bangalore)
│   ├── Legacy ERP systems
│   ├── Financial databases (compliance)
│   ├── Employee Active Directory
│   ├── Backup and archive systems
│   └── Development workstations
├── AWS Cloud Infrastructure
│   ├── Web applications and APIs
│   ├── Content delivery systems
│   ├── Analytics and ML workloads
│   ├── Disaster recovery systems
│   └── Global expansion resources
└── Connectivity Requirements
    ├── Secure communication between environments
    ├── Seamless user experience
    ├── Data synchronization needs
    ├── Backup and disaster recovery
    └── Compliance and audit requirements
```

### The Solution: AWS Site-to-Site VPN
Site-to-Site VPN enabled MyLearning.com to securely connect their on-premises network to AWS VPCs over the internet.

## What is AWS Site-to-Site VPN?

### Definition
AWS Site-to-Site VPN creates a secure connection between your data center or branch office and your AWS resources using Internet Protocol Security (IPSec) VPN tunnels.

### Key Components
```
Site-to-Site VPN Architecture:
├── Virtual Private Gateway (VGW)
│   ├── AWS-side VPN endpoint
│   ├── Attached to VPC
│   ├── Route propagation support
│   └── High availability by design
├── Customer Gateway (CGW)
│   ├── On-premises VPN device representation
│   ├── Static or dynamic routing
│   ├── Device configuration information
│   └── Public IP address requirement
├── VPN Connection
│   ├── Two IPSec tunnels for redundancy
│   ├── Encrypted communication
│   ├── BGP or static routing
│   └── Monitoring and metrics
└── Route Tables
    ├── VPC route table updates
    ├── On-premises route configuration
    ├── Route propagation (BGP)
    └── Traffic flow control
```

## MyLearning.com's Site-to-Site VPN Implementation

### Network Architecture
```
Hybrid Network Design:
┌─────────────────────────────────────────┐
│  On-Premises Network (Bangalore)        │
│  CIDR: 192.168.0.0/16                  │
│  ├── Corporate LAN: 192.168.1.0/24     │
│  ├── Server Network: 192.168.10.0/24   │
│  ├── DMZ: 192.168.100.0/24             │
│  └── Customer Gateway Device           │
│      ├── Cisco ASA 5516-X              │
│      ├── Public IP: 203.0.113.12       │
│      └── BGP ASN: 65000                │
└─────────────┬───────────────────────────┘
              │ Site-to-Site VPN
              │ (Two IPSec Tunnels)
┌─────────────▼───────────────────────────┐
│  AWS VPC (ap-south-1)                  │
│  CIDR: 10.0.0.0/16                     │
│  ├── Public Subnets: 10.0.1.0/24      │
│  ├── Private Subnets: 10.0.2.0/24     │
│  ├── Database Subnets: 10.0.3.0/24    │
│  └── Virtual Private Gateway           │
│      ├── AWS Managed                   │
│      ├── BGP ASN: 64512                │
│      └── High Availability             │
└─────────────────────────────────────────┘
```

### VPN Connection Details
```
VPN Configuration:
├── Tunnel 1
│   ├── AWS Public IP: 52.95.255.1
│   ├── Customer Gateway IP: 203.0.113.12
│   ├── Pre-shared Key: [Generated by AWS]
│   ├── BGP ASN: AWS 64512, Customer 65000
│   └── Status: UP
├── Tunnel 2
│   ├── AWS Public IP: 52.95.255.2
│   ├── Customer Gateway IP: 203.0.113.12
│   ├── Pre-shared Key: [Generated by AWS]
│   ├── BGP ASN: AWS 64512, Customer 65000
│   └── Status: UP
├── Routing Protocol: BGP
├── Encryption: AES-256
├── Authentication: SHA-256
└── Perfect Forward Secrecy: Enabled
```

## Site-to-Site VPN Components Deep Dive

### 1. Virtual Private Gateway (VGW)

#### Characteristics
```
VGW Properties:
├── AWS-Managed Service
│   ├── Highly available by design
│   ├── Automatic failover
│   ├── No single point of failure
│   └── Maintenance handled by AWS
├── Attachment Options
│   ├── Single VPC attachment
│   ├── Multiple VPN connections
│   ├── Direct Connect Gateway integration
│   └── Transit Gateway migration path
├── Routing Support
│   ├── Static routing
│   ├── Dynamic routing (BGP)
│   ├── Route propagation
│   └── Route priority management
└── Performance
    ├── Up to 1.25 Gbps per tunnel
    ├── Two tunnels for redundancy
    ├── ECMP support with Transit Gateway
    └── Consistent performance
```

#### MyLearning.com VGW Configuration
```
VGW Setup:
├── Name: MyLearning-VGW
├── Amazon ASN: 64512 (default)
├── Attached VPC: MyLearning-Prod-VPC
├── Route Propagation: Enabled
├── VPN Connections: 1 (to Bangalore office)
└── Status: Available
```

### 2. Customer Gateway (CGW)

#### Device Requirements
```
Customer Gateway Requirements:
├── Static Public IP Address
│   ├── Internet-routable IP
│   ├── No NAT traversal support
│   ├── Consistent IP address
│   └── Firewall/router configuration
├── VPN Device Capabilities
│   ├── IPSec support
│   ├── BGP support (recommended)
│   ├── Dead Peer Detection (DPD)
│   └── NAT-T support
├── Supported Devices
│   ├── Cisco ASA, ISR, Meraki
│   ├── Juniper SRX, MX series
│   ├── Palo Alto Networks
│   ├── pfSense, strongSwan
│   └── Many other vendors
└── Configuration Requirements
    ├── IPSec parameters matching
    ├── Routing protocol setup
    ├── Firewall rule configuration
    └── Monitoring and logging
```

#### MyLearning.com CGW Setup
```
Customer Gateway Configuration:
├── Device: Cisco ASA 5516-X
├── Public IP: 203.0.113.12
├── BGP ASN: 65000
├── Routing: Dynamic (BGP)
├── Certificate: None (PSK authentication)
└── Device Configuration:
    ├── IPSec Phase 1 (IKE)
    │   ├── Encryption: AES-256
    │   ├── Authentication: SHA-256
    │   ├── DH Group: 14
    │   └── Lifetime: 28800 seconds
    ├── IPSec Phase 2 (ESP)
    │   ├── Encryption: AES-256
    │   ├── Authentication: SHA-256
    │   ├── PFS: Group 14
    │   └── Lifetime: 3600 seconds
    └── BGP Configuration
        ├── Local ASN: 65000
        ├── Remote ASN: 64512
        ├── Neighbor IPs: Tunnel interfaces
        └── Route advertisement
```

### 3. VPN Connection Configuration

#### IPSec Tunnel Parameters
```
IPSec Configuration:
├── Phase 1 (IKE) Parameters
│   ├── Encryption Algorithm: AES-256
│   ├── Authentication Algorithm: SHA-256
│   ├── Diffie-Hellman Group: 14
│   ├── Lifetime: 28800 seconds (8 hours)
│   ├── Mode: Main mode
│   └── Pre-shared Key: AWS generated
├── Phase 2 (IPSec) Parameters
│   ├── Encryption Algorithm: AES-256
│   ├── Authentication Algorithm: SHA-256
│   ├── Perfect Forward Secrecy: Group 14
│   ├── Lifetime: 3600 seconds (1 hour)
│   ├── Mode: Tunnel mode
│   └── DPD: Enabled (10 seconds)
├── Tunnel Interface Configuration
│   ├── Tunnel 1: 169.254.255.1/30 (AWS side)
│   ├── Tunnel 1: 169.254.255.2/30 (Customer side)
│   ├── Tunnel 2: 169.254.255.5/30 (AWS side)
│   └── Tunnel 2: 169.254.255.6/30 (Customer side)
└── BGP Configuration
    ├── BGP over tunnel interfaces
    ├── Route advertisement
    ├── Route preference
    └── Failover behavior
```

## Routing Configuration

### 1. Static Routing
```
Static Route Configuration:
├── AWS Side (VPC Route Tables)
│   ├── Destination: 192.168.0.0/16
│   ├── Target: Virtual Private Gateway
│   ├── Propagation: Disabled
│   └── Manual route management
├── Customer Side (On-premises)
│   ├── Destination: 10.0.0.0/16
│   ├── Next-hop: VPN tunnel interface
│   ├── Administrative distance: 1
│   └── Backup route via second tunnel
├── MyLearning.com Static Routes
│   ├── AWS → On-premises: 192.168.0.0/16 via VGW
│   ├── On-premises → AWS: 10.0.0.0/16 via tunnel
│   ├── Specific routes for subnets
│   └── Default route considerations
└── Route Priorities
    ├── Most specific route wins
    ├── Administrative distance
    ├── Metric considerations
    └── Load balancing options
```

### 2. Dynamic Routing (BGP)
```
BGP Configuration:
├── BGP Session Establishment
│   ├── BGP neighbors over tunnel interfaces
│   ├── Authentication (MD5 optional)
│   ├── Hold time: 180 seconds
│   └── Keepalive: 60 seconds
├── Route Advertisement
│   ├── AWS advertises VPC CIDR
│   ├── Customer advertises on-premises networks
│   ├── Route filtering capabilities
│   └── AS path manipulation
├── MyLearning.com BGP Setup
│   ├── AWS ASN: 64512
│   ├── Customer ASN: 65000
│   ├── Advertised routes: Specific subnets
│   ├── Route maps for filtering
│   └── Local preference settings
└── Failover and Load Balancing
    ├── Both tunnels active
    ├── Equal cost multi-path (ECMP)
    ├── Automatic failover
    └── Route convergence time
```

## Security Considerations

### 1. Encryption and Authentication
```
Security Features:
├── IPSec Encryption
│   ├── AES-256 encryption
│   ├── SHA-256 authentication
│   ├── Perfect Forward Secrecy
│   └── Regular key rotation
├── Authentication Methods
│   ├── Pre-shared keys (PSK)
│   ├── Certificate-based (optional)
│   ├── Strong key generation
│   └── Key management practices
├── Tunnel Security
│   ├── Dead Peer Detection (DPD)
│   ├── Replay protection
│   ├── Anti-replay window
│   └── Tunnel monitoring
└── Network Security
    ├── Security groups
    ├── Network ACLs
    ├── On-premises firewall rules
    └── Traffic inspection
```

### 2. Access Control
```
Access Control Implementation:
├── AWS Security Groups
│   ├── Allow traffic from on-premises CIDR
│   ├── Specific port and protocol rules
│   ├── Principle of least privilege
│   └── Regular rule audits
├── Network ACLs
│   ├── Subnet-level protection
│   ├── Stateless filtering
│   ├── Allow/deny rules
│   └── Logging capabilities
├── On-premises Firewall
│   ├── Allow VPN traffic (UDP 500, 4500)
│   ├── Allow specific application traffic
│   ├── Block unnecessary protocols
│   └── Intrusion detection/prevention
└── MyLearning.com Security Rules
    ├── ERP access: Port 1433 from specific IPs
    ├── AD authentication: Port 389, 636
    ├── File sharing: Port 445 (restricted)
    └── Management: SSH/RDP from admin networks
```

## Performance and Optimization

### 1. Bandwidth and Throughput
```
Performance Characteristics:
├── Tunnel Bandwidth
│   ├── Up to 1.25 Gbps per tunnel
│   ├── Two tunnels for redundancy
│   ├── Aggregate: Up to 2.5 Gbps
│   └── Internet bandwidth dependent
├── Latency Considerations
│   ├── Internet routing dependent
│   ├── Geographic distance impact
│   ├── ISP network quality
│   └── Encryption overhead minimal
├── MyLearning.com Performance
│   ├── Bangalore to Mumbai: ~25ms
│   ├── Throughput: 500 Mbps average
│   ├── Peak usage: 1.2 Gbps
│   └── 99.9% availability achieved
└── Optimization Techniques
    ├── TCP MSS clamping
    ├── Path MTU discovery
    ├── Traffic shaping
    └── QoS implementation
```

### 2. High Availability
```
HA Configuration:
├── Redundant Tunnels
│   ├── Two IPSec tunnels per connection
│   ├── Different AWS endpoints
│   ├── Automatic failover
│   └── Load balancing support
├── Customer Gateway Redundancy
│   ├── Multiple customer gateways
│   ├── Different physical devices
│   ├── Separate internet connections
│   └── BGP route preference
├── MyLearning.com HA Setup
│   ├── Primary CGW: Cisco ASA 5516-X
│   ├── Secondary CGW: Cisco ASA 5508-X
│   ├── Dual internet connections
│   ├── BGP route manipulation
│   └── Automatic failover testing
└── Monitoring and Alerting
    ├── Tunnel status monitoring
    ├── BGP session monitoring
    ├── Performance metrics
    └── Automated notifications
```

## Monitoring and Troubleshooting

### 1. CloudWatch Metrics
```
Key Metrics:
├── Tunnel State
│   ├── TunnelState (UP/DOWN)
│   ├── TunnelIpAddress
│   ├── BGP session status
│   └── Last status change
├── Traffic Metrics
│   ├── TunnelBytesIn/Out
│   ├── TunnelPacketsIn/Out
│   ├── TunnelLatency
│   └── TunnelThroughput
├── Error Metrics
│   ├── TunnelErrors
│   ├── PacketDropCount
│   ├── BGP routing errors
│   └── Authentication failures
└── MyLearning.com Dashboards
    ├── Real-time tunnel status
    ├── Traffic utilization trends
    ├── Performance metrics
    └── SLA compliance tracking
```

### 2. VPC Flow Logs
```
Flow Logs Analysis:
├── VPN Traffic Identification
│   ├── Source/destination IPs
│   ├── Protocol and port information
│   ├── Accept/reject decisions
│   └── Packet and byte counts
├── Troubleshooting Use Cases
│   ├── Connectivity issues
│   ├── Performance problems
│   ├── Security incidents
│   └── Capacity planning
├── MyLearning.com Implementation
│   ├── All VPN traffic logged
│   ├── CloudWatch Logs integration
│   ├── Real-time analysis
│   └── Automated alerting
└── Analysis Tools
    ├── CloudWatch Insights queries
    ├── Third-party log analysis
    ├── Custom dashboards
    └── Reporting automation
```

### 3. Common Troubleshooting Steps
```
Troubleshooting Methodology:
├── Tunnel Status Check
│   ├── AWS Console verification
│   ├── Customer gateway logs
│   ├── IPSec SA status
│   └── BGP session status
├── Connectivity Testing
│   ├── Ping tests across tunnel
│   ├── Traceroute analysis
│   ├── Port connectivity tests
│   └── Application-level testing
├── Configuration Verification
│   ├── IPSec parameters matching
│   ├── Routing table verification
│   ├── Security group rules
│   └── Firewall configurations
├── Performance Analysis
│   ├── Bandwidth utilization
│   ├── Latency measurements
│   ├── Packet loss analysis
│   └── MTU size verification
└── MyLearning.com Tools
    ├── Network monitoring tools
    ├── Custom health checks
    ├── Automated diagnostics
    └── Escalation procedures
```

## Cost Considerations

### 1. VPN Connection Costs
```
Cost Components:
├── VPN Connection Charges
│   ├── $0.05 per hour per VPN connection
│   ├── $36 per month per connection
│   ├── No setup or termination fees
│   └── Charged when connection exists
├── Data Transfer Costs
│   ├── Outbound data transfer charges apply
│   ├── $0.09 per GB (first 1 GB free)
│   ├── Inbound data transfer free
│   └── Regional pricing variations
├── MyLearning.com Monthly Costs
│   ├── VPN Connection: $36
│   ├── Data Transfer (200 GB): $18
│   ├── Customer Gateway device: $200
│   └── Total: $254/month
└── Cost Optimization
    ├── Data compression
    ├── Traffic optimization
    ├── Scheduled connections (if applicable)
    └── Regular cost reviews
```

### 2. Comparison with Alternatives
```
Cost Comparison (Monthly):
├── Site-to-Site VPN
│   ├── Connection: $36
│   ├── Data transfer: $18
│   ├── Equipment: $200
│   └── Total: $254
├── AWS Direct Connect
│   ├── Port: $216 (1 Gbps)
│   ├── Data transfer: $9 (reduced rates)
│   ├── Cross-connect: $100
│   └── Total: $325
├── Internet-only
│   ├── Connection: $0
│   ├── Data transfer: $18
│   ├── Security risks: High
│   └── Total: $18 (not recommended)
└── MyLearning.com Decision
    ├── VPN chosen for cost-effectiveness
    ├── Security requirements met
    ├── Performance adequate
    └── Future Direct Connect consideration
```

## Migration and Implementation

### 1. Implementation Steps
```
Implementation Process:
├── Phase 1: Planning and Design
│   ├── Network architecture design
│   ├── IP address planning
│   ├── Security requirements analysis
│   └── Device compatibility verification
├── Phase 2: AWS Configuration
│   ├── Create Customer Gateway
│   ├── Create Virtual Private Gateway
│   ├── Attach VGW to VPC
│   ├── Create VPN connection
│   └── Download configuration files
├── Phase 3: On-premises Configuration
│   ├── Configure customer gateway device
│   ├── Establish IPSec tunnels
│   ├── Configure routing (BGP/static)
│   ├── Update firewall rules
│   └── Test connectivity
├── Phase 4: Route Configuration
│   ├── Update VPC route tables
│   ├── Enable route propagation
│   ├── Configure on-premises routing
│   └── Verify end-to-end connectivity
└── Phase 5: Testing and Optimization
    ├── Comprehensive connectivity testing
    ├── Performance optimization
    ├── Failover testing
    └── Documentation and training
```

### 2. MyLearning.com Results
```
Implementation Outcomes:
├── Connectivity Achieved
│   ├── Secure connection established
│   ├── 99.9% uptime achieved
│   ├── 500 Mbps average throughput
│   └── <30ms latency maintained
├── Business Benefits
│   ├── Seamless hybrid operations
│   ├── Secure data synchronization
│   ├── Centralized user management
│   ├── Disaster recovery capability
│   └── Compliance requirements met
├── Operational Improvements
│   ├── Reduced manual processes
│   ├── Automated backup and sync
│   ├── Centralized monitoring
│   ├── Simplified troubleshooting
│   └── Better resource utilization
└── Cost Savings
    ├── Reduced MPLS costs: $500/month
    ├── VPN implementation: $254/month
    ├── Net savings: $246/month
    └── ROI achieved in 3 months
```

---

*Next: AWS Client VPN for secure remote access to AWS resources for MyLearning.com's distributed workforce.*